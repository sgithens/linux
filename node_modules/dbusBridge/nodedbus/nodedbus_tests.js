/*!
 * GPII Node.js DBus Bridge
 *
 * Copyright 2012 Javier Hern√°ndez
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * You may obtain a copy of the License at
 * https://github.com/gpii/universal/LICENSE.txt
 * */

var util = require('util');
var assert = require('assert');
var exec = require('child_process').exec;
var nodedbus = require('./build/Release/nodedbus');

function wait(millis)
{
  var date = new Date();
  var curDate = null;
  
  do { curDate = new Date(); }
  while(curDate-date < millis);
} 

console.log("Enable Magnifier\n");
nodedbus.dbus_call_sync("org.gnome.Magnifier","/org/gnome/Magnifier","org.gnome.Magnifier","setActive",true);

wait(3000);

console.log("Disable Magnifier\n");
nodedbus.dbus_call_sync("org.gnome.Magnifier","/org/gnome/Magnifier","org.gnome.Magnifier","setActive",false);

wait(3000);

console.log("Installing extension\n");
nodedbus.dbus_call_sync("org.gnome.Shell","/org/gnome/Shell","org.gnome.Shell","InstallRemoteExtension",["axemenu@wheezy", ""]);

wait(20000);

console.log("Uninstalling extension\n");
nodedbus.dbus_call_sync("org.gnome.Shell","/org/gnome/Shell","org.gnome.Shell","UninstallExtension","axemenu@wheezy");

console.log("Listing installed GNOME Shell extensions:\n");
var installed_extensions = nodedbus.dbus_call_sync("org.gnome.Shell","/org/gnome/Shell","org.gnome.Shell","ListExtensions",null);
console.log(installed_extensions);
